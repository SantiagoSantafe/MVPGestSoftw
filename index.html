<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Citas Médicas</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="script.js" defer></script>
</head>
<body>
    <!-- Cabecera con información de usuario y notificaciones -->
    <header>
        <div class="logo">
            <img src="logo-placeholder.png" alt="Logo MediConsulta">
            <h1>MediConsulta</h1>
        </div>
        <div class="user-info">
            <div class="notifications" onclick="toggleNotifications()">
                <i class="fas fa-bell"></i>
                <span class="notification-badge">3</span>
            </div>
            <div class="profile" onclick="toggleProfileMenu()">
                <img src="profile-placeholder.png" alt="Perfil">
                <span>Juan Pérez</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <!-- Panel de notificaciones -->
            <div id="notificationsPanel" class="notifications-panel">
                <h3>Notificaciones</h3>
                <div class="notification-item unread">
                    <i class="fas fa-calendar-check"></i>
                    <div>
                        <p>Recordatorio: Tienes una cita mañana a las 14:30 con Dr. Martínez.</p>
                        <small>Hace 2 horas</small>
                    </div>
                </div>
                <div class="notification-item">
                    <i class="fas fa-money-bill-wave"></i>
                    <div>
                        <p>Reembolso procesado por cancelación de cita.</p>
                        <small>Hace 1 día</small>
                    </div>
                </div>
                <a href="#" class="ver-todas">Ver todas</a>
            </div>
            <!-- Menú de perfil -->
            <div id="profileMenu" class="profile-menu">
                <a href="#"><i class="fas fa-user"></i> Mi perfil</a>
                <a href="#"><i class="fas fa-cog"></i> Configuración</a>
                <a href="#" onclick="showLoginForm()"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</a>
            </div>
        </div>
    </header>

    <!-- Menú principal de navegación -->
    <div class="menu">
        <div>
            <a href="#" class="active" onclick="showCitas()"><i class="fas fa-calendar-alt"></i> Mis Citas</a>
            <a href="#" onclick="showTratamientos()"><i class="fas fa-prescription"></i> Tratamientos</a>
            <a href="#" onclick="showHelp()"><i class="fas fa-question-circle"></i> Ayuda</a>
        </div>
        <button onclick="window.location.href='./Paciente_Agendar/agendar.html'" class="btn-agendar">
            <i class="fas fa-plus"></i> Agendar
        </button>
    </div>

    <!-- Filtros para citas -->
    <div id="filterSection" class="filter-section">
        <h2>Mis Citas</h2>
        <div class="filters">
            <div class="filter-group">
                <label for="filterDate">Fecha:</label>
                <input type="date" id="filterDate">
            </div>
            <div class="filter-group">
                <label for="filterEspecialidad">Especialidad:</label>
                <select id="filterEspecialidad">
                    <option value="all">Todas</option>
                    <option value="general">Medicina General</option>
                    <option value="cardio">Cardiología</option>
                    <option value="derma">Dermatología</option>
                </select>
            </div>
            <button onclick="aplicarFiltros()" class="btn-filtrar">
                <i class="fas fa-filter"></i> Aplicar filtros
            </button>
        </div>
    </div>

    <!-- Lista de citas -->
    <div id="citasList" class="lista">
        <!-- Cita 1 -->
        <div class="ficha">
            <div class="cita-info">
                <div class="cita-fecha">
                    <i class="fas fa-calendar-day"></i>
                    <strong>12/04/2025</strong>
                </div>
                <div class="cita-hora">
                    <i class="fas fa-clock"></i>
                    <span>14:30</span>
                </div>
                <div class="cita-especialista">
                    <i class="fas fa-user-md"></i>
                    <span>Dr. Carlos Martínez - Medicina General</span>
                </div>
                <div class="cita-motivo">
                    <i class="fas fa-notes-medical"></i>
                    <span>Dolor abdominal y fiebre</span>
                </div>
            </div>
            <div class="cita-acciones">
                <button onclick="openModal(1)" class="btn-video">
                    <i class="fas fa-video"></i> Entrar
                </button>
                <button onclick="openReagendarModal(1)" class="btn-reagendar" title="Reagendar cita">
                    <i class="fas fa-calendar-alt"></i>
                </button>
            </div>
        </div>

        <!-- Cita 2 -->
        <div class="ficha">
            <div class="cita-info">
                <div class="cita-fecha">
                    <i class="fas fa-calendar-day"></i>
                    <strong>18/04/2025</strong>
                </div>
                <div class="cita-hora">
                    <i class="fas fa-clock"></i>
                    <span>10:15</span>
                </div>
                <div class="cita-especialista">
                    <i class="fas fa-user-md"></i>
                    <span>Dra. Laura Sánchez - Cardiología</span>
                </div>
                <div class="cita-motivo">
                    <i class="fas fa-notes-medical"></i>
                    <span>Control anual de presión arterial</span>
                </div>
            </div>
            <div class="cita-acciones">
                <button class="btn-video disabled" disabled>
                    <i class="fas fa-video"></i> Entrar
                </button>
                <button onclick="openReagendarModal(2)" class="btn-reagendar" title="Reagendar cita">
                    <i class="fas fa-calendar-alt"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Sección de Tratamientos (inicialmente oculta) -->
    <div id="tratamientosSection" class="section-container" style="display: none;">
        <div class="section-header">
            <h2><i class="fas fa-prescription"></i> Mis Tratamientos</h2>
            <div class="filter-group compact">
                <label for="filterTreatmentDate">Filtrar:</label>
                <input type="date" id="filterTreatmentDate">
                <select id="filterTreatmentType">
                    <option value="all">Todas las especialidades</option>
                    <option value="general">Medicina General</option>
                    <option value="cardio">Cardiología</option>
                </select>
                <button class="btn-filtrar">Aplicar</button>
            </div>
        </div>
        <div class="tratamientos-list">
            <div class="tratamiento-card">
                <div class="tratamiento-header">
                    <h3>Consulta: 05/04/2025</h3>
                    <span class="especialidad">Medicina General</span>
                </div>
                <div class="tratamiento-body">
                    <p><strong>Diagnóstico:</strong> Gastritis aguda</p>
                    <p><strong>Prescripción:</strong> Omeprazol 20mg, Sucralfato suspensión</p>
                    <p><strong>Indicaciones:</strong> Omeprazol: 1 cápsula en ayunas por 14 días. Sucralfato: 10ml antes de cada comida por 7 días.</p>
                </div>
                <div class="tratamiento-footer">
                    <button class="btn-download">
                        <i class="fas fa-download"></i> Descargar
                    </button>
                    <button class="btn-print">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sección de Ayuda (inicialmente oculta) -->
    <div id="helpSection" class="section-container" style="display: none;">
        <div class="section-header">
            <h2><i class="fas fa-question-circle"></i> Centro de Ayuda</h2>
        </div>
        <div class="help-content">
            <div class="faq-section">
                <h3>Preguntas Frecuentes</h3>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        ¿Cómo agendo una cita médica?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        Para agendar una cita, haz clic en el botón "+ Agendar" en la parte superior derecha. Selecciona el especialista, fecha, hora y proporciona el motivo de tu consulta. Finaliza realizando el pago correspondiente.
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFaq(this)">
                        ¿Cómo puedo cancelar o reagendar una cita?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        En la lista de "Mis Citas", cada tarjeta tiene botones para reagendar (ícono de calendario) o cancelar (ícono de basura). Al cancelar, deberás indicar el motivo y recibirás un reembolso por el mismo medio de pago utilizado.
                    </div>
                </div>
            </div>
            
            <div class="contact-support">
                <h3>¿Necesitas más ayuda?</h3>
                <p>Contáctanos:</p>
                <div class="contact-options">
                    <a href="tel:+573001234567" class="contact-option">
                        <i class="fas fa-phone"></i>
                        <span>Línea de atención: 300 123 4567</span>
                    </a>
                    <a href="mailto:soporte@mediconsulta.com" class="contact-option">
                        <i class="fas fa-envelope"></i>
                        <span>soporte@mediconsulta.com</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para entrar a la consulta -->
    <div id="modal-overlay" class="modal-overlay" onclick="closeModal()"></div>
    <div id="modal" class="modal">
        <div class="modal-header">
            <h3>Consulta Virtual</h3>
            <button onclick="closeModal()" class="btn-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p>¿Deseas entrar a la consulta con el Dr. Carlos Martínez?</p>
            <p class="modal-details">
                <i class="fas fa-calendar-day"></i> <strong>12/04/2025</strong> &nbsp;
                <i class="fas fa-clock"></i> <strong>14:30</strong>
            </p>
            <div class="modal-actions">
                <button onclick="openVideoCall()" class="btn-primary">
                    <i class="fas fa-video"></i> Entrar a la consulta
                </button>
                <button onclick="closeModal()" class="btn-secondary">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para cancelar cita -->
    <div id="cancelModal" class="modal">
        <div class="modal-header">
            <h3>Cancelar Cita</h3>
            <button onclick="closeCancelModal()" class="btn-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p>¿Estás seguro que deseas cancelar tu cita?</p>
            <p class="modal-details">
                <i class="fas fa-calendar-day"></i> <span id="cancelDate">12/04/2025</span> &nbsp;
                <i class="fas fa-clock"></i> <span id="cancelTime">14:30</span> &nbsp;
                <i class="fas fa-user-md"></i> <span id="cancelDoctor">Dr. Carlos Martínez</span>
            </p>
            
            <div class="form-group">
                <label for="cancelReason">Por favor indica el motivo de la cancelación:</label>
                <textarea id="cancelReason" rows="3" placeholder="Escribe el motivo aquí..." required></textarea>
            </div>
            
            <p class="refund-info">
                <i class="fas fa-info-circle"></i> Recibirás un reembolso por el mismo medio de pago utilizado.
            </p>
            
            <div class="modal-actions">
                <button onclick="confirmCancelCita()" class="btn-danger">
                    <i class="fas fa-trash-alt"></i> Confirmar Cancelación
                </button>
                <button onclick="closeCancelModal()" class="btn-secondary">
                    <i class="fas fa-times"></i> Volver
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para reagendar cita -->
    <div id="reagendarModal" class="modal">
        <div class="modal-header">
            <h3>Reagendar Cita</h3>
            <button onclick="closeReagendarModal()" class="btn-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p>Selecciona una nueva fecha y hora para tu cita:</p>
            <p class="modal-details">
                <i class="fas fa-user-md"></i> <span id="reagendarDoctor">Dr. Carlos Martínez - Medicina General</span>
            </p>
            
            <div class="form-group">
                <label for="newDate">Nueva fecha:</label>
                <input type="date" id="newDate" min="2025-04-13" required>
            </div>
            
            <div class="form-group">
                <label for="newTime">Horarios disponibles:</label>
                <div class="time-slots">
                    <div class="time-slot available">09:00</div>
                    <div class="time-slot available">09:30</div>
                    <div class="time-slot available">10:00</div>
                    <div class="time-slot available">11:30</div>
                    <div class="time-slot available">15:00</div>
                    <div class="time-slot available">16:30</div>
                </div>
            </div>
            
            <div class="modal-actions">
                <button onclick="confirmReagendarCita()" class="btn-primary">
                    <i class="fas fa-calendar-check"></i> Confirmar cambio
                </button>
                <button onclick="closeReagendarModal()" class="btn-secondary">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Videollamada (versión mejorada) -->
<div id="videocallContainer" class="videocall-container">
    <div class="videocall-header">
        <div class="call-info">
            <h3>Consulta con Dr. Carlos Martínez</h3>
            <span class="call-timer">00:00:00</span>
        </div>
        <div class="call-actions">
            <button class="btn-mic active" onclick="toggleMic()">
                <i class="fas fa-microphone"></i>
            </button>
            <button class="btn-camera active" onclick="toggleCamera()">
                <i class="fas fa-video"></i>
            </button>
            <button class="btn-end-call" onclick="endVideoCall()">
                <i class="fas fa-phone-slash"></i>
            </button>
        </div>
    </div>
    
    <div class="videocall-content">
        <div class="video-area">
            <div class="main-video">
                <video id="doctorVideo" autoplay muted class="hidden"></video>
                <div id="doctorPlaceholder" class="video-placeholder doctor">
                    <i class="fas fa-user-md"></i>
                    <span>Dr. Carlos Martínez</span>
                </div>
            </div>
            <div class="self-video">
                <video id="selfVideo" autoplay muted></video>
                <div id="selfPlaceholder" class="video-placeholder patient hidden">
                    <i class="fas fa-user"></i>
                    <span>Tú</span>
                </div>
            </div>
        </div>
        
        <div class="chat-prescription-area">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('chat')">Chat</div>
                <div class="tab" onclick="switchTab('prescription')">Prescripción</div>
            </div>
            
            <div id="chatTab" class="tab-content active">
                <div id="chatMessages" class="chat-messages">
                    <div class="message doctor">
                        <span class="message-name">Dr. Carlos Martínez</span>
                        <div class="message-bubble">Hola, bienvenido a la consulta. ¿Cómo te has sentido desde la última vez?</div>
                        <span class="message-time">14:32</span>
                    </div>
                </div>
                <div class="chat-input">
                    <textarea id="messageInput" placeholder="Escribe un mensaje..." onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"></textarea>
                    <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
            
            <div id="prescriptionTab" class="tab-content">
                <div class="prescription-content">
                    <h4>Prescripción médica</h4>
                    <div class="prescription-details">
                        <p><strong>Diagnóstico preliminar:</strong> <span id="diagnostico">Pendiente</span></p>
                        <p><strong>Medicamentos:</strong></p>
                        <ul id="medicamentos">
                            <li>El médico añadirá la prescripción durante la consulta</li>
                        </ul>
                        <p><strong>Recomendaciones:</strong></p>
                        <ul id="recomendaciones">
                            <li>Pendiente de recomendaciones del médico</li>
                        </ul>
                        <p><small>Esta prescripción estará disponible en la sección de "Tratamientos" una vez finalizada la consulta.</small></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Formulario de Login -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-container">
            <div class="login-header">
                <img src="logo-placeholder.png" alt="Logo MediConsulta" class="login-logo">
                <h2>MediConsulta</h2>
            </div>
            <div class="login-form">
                <h3>Iniciar Sesión</h3>
                <div class="form-group">
                    <label for="cedula">Número de Cédula:</label>
                    <input type="text" id="cedula" placeholder="Ingresa tu número de cédula" required>
                </div>
                <div class="form-group">
                    <label for="email">Correo Electrónico:</label>
                    <input type="email" id="email" placeholder="Ingresa tu correo electrónico" required>
                </div>
                <div class="form-group">
                    <label for="password">Contraseña:</label>
                    <div class="password-input">
                        <input type="password" id="password" placeholder="Ingresa tu contraseña" required>
                        <button type="button" class="toggle-password">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-actions">
                    <label class="remember-me">
                        <input type="checkbox"> Recordarme
                    </label>
                    <a href="#" class="forgot-password">¿Olvidaste tu contraseña?</a>
                </div>
                <button onclick="login()" class="btn-login">Iniciar Sesión</button>
            </div>
        </div>
    </div>
</body>
</html>